# 图片水印命令行程序产品需求文档

## 1. 产品概述
开发一个命令行工具，用于批量为图片添加基于拍摄日期的水印，并支持自定义水印样式和位置。

## 2. 核心功能

### 2.1 图片路径处理
- 接受用户输入的图片文件路径（支持单个文件或目录）
- 自动识别并处理支持的图片格式

### 2.2 EXIF信息提取
- 读取图片的EXIF元数据
- 提取拍摄时间信息（如果存在）
- 格式化时间为年月日格式（YYYY-MM-DD）
- 对于没有EXIF时间的图片，提供默认水印选项

### 2.3 水印自定义
- 支持设置字体大小
- 支持设置字体颜色（支持标准颜色名称或HEX值）
- 支持设置水印位置（左上角、右上角、左下角、右下角、居中）
- 支持设置水印透明度

### 2.4 图片处理与保存
- 将水印文本绘制到图片上
- 创建输出目录：原目录名_watermark（作为原目录的子目录）
- 保存处理后的图片到输出目录
- 保持原图片格式和质量

## 3. 命令行参数设计

```
photo-watermark --path <图片路径> [选项]
```

### 3.1 必选参数
- `--path`, `-p`: 图片文件或目录的路径

### 3.2 可选参数
- `--font-size`, `-s`: 水印字体大小（默认：16）
- `--color`, `-c`: 水印字体颜色（默认：白色）
- `--position`, `-pos`: 水印位置（默认：右下角）
  - 可选值：top-left, top-right, bottom-left, bottom-right, center
- `--opacity`, `-o`: 水印透明度（0-100，默认：80）
- `--default-text`, `-d`: 无EXIF信息时的默认水印文本
- `--help`, `-h`: 显示帮助信息
- `--version`, `-v`: 显示版本信息

## 4. 技术要求

### 4.1 编程语言
- 可使用Python、Node.js、Go等语言实现
- 推荐使用Python，因为其在图像处理和EXIF读取方面有丰富的库支持

### 4.2 依赖库
- 图像处理库：Pillow（Python）、Jimp（Node.js）等
- EXIF信息提取库：piexif（Python）、exif-js（Node.js）等

### 4.3 支持的图片格式
- JPEG、PNG、BMP、TIFF等常见格式

## 5. 工作流程

1. 用户通过命令行输入图片路径和水印参数
2. 程序解析命令行参数
3. 程序扫描指定路径下的所有图片文件
4. 对每个图片文件：
   a. 读取EXIF信息，提取拍摄日期
   b. 根据用户参数设置水印样式
   c. 在指定位置绘制水印
5. 创建输出目录
6. 将处理后的图片保存到输出目录
7. 显示处理结果统计信息

## 6. 错误处理

- 处理文件路径不存在的情况
- 处理无读写权限的情况
- 处理不支持的图片格式
- 处理没有EXIF信息的图片
- 提供清晰的错误提示信息

## 7. 性能要求

- 支持处理大量图片的批处理功能
- 优化内存使用，避免同时加载过多图片
- 合理利用CPU资源，提高处理速度

## 8. 后续扩展功能（可选）

- 支持添加图片水印
- 支持批量处理不同目录
- 支持自定义水印文本格式
- 支持水印旋转角度设置
- 支持GUI界面

## 9. 示例使用场景

```bash
# 基本使用 - 处理单个文件
photo-watermark --path "C:\Users\User\Photos\example.jpg"

# 处理整个目录
photo-watermark --path "C:\Users\User\Photos\Vacation"

# 自定义水印样式
photo-watermark --path "C:\Users\User\Photos" --font-size 24 --color "red" --position "center" --opacity 50

# 使用默认文本（当图片无EXIF信息时）
photo-watermark --path "C:\Users\User\Photos" --default-text "My Photo"```